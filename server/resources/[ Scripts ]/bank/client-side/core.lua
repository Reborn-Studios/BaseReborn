-----------------------------------------------------------------------------------------------------------------------------------------
-- VRP
-----------------------------------------------------------------------------------------------------------------------------------------
local Tunnel = module("vrp","lib/Tunnel")
local Proxy = module("vrp","lib/Proxy")
vRP = Proxy.getInterface("vRP")
-----------------------------------------------------------------------------------------------------------------------------------------
-- CONNECTION
-----------------------------------------------------------------------------------------------------------------------------------------
vSERVER = Tunnel.getInterface("bank")
-----------------------------------------------------------------------------------------------------------------------------------------
-- LIST
-----------------------------------------------------------------------------------------------------------------------------------------
local Banks = {
	[1]     = vector3(149.88, -1040.34, 29.37),
	[2]     = vector3(-350.83, -49.6, 49.04),
	[3]     = vector3(314.36, -278.46, 54.17),
	[4]     = vector3(-1212.98, -330.26, 37.79),
	[5]     = vector3(-2963.45, 482.81, 15.7),
	[6]     = vector3(1175.15, 2706.07, 38.09),
	[7]     = vector3(1653.78, 4850.56, 41.99),
	[8]     = vector3(-1074.67, -2559.01, 13.97),
	[9]     = vector3(-112.22, 6468.92, 31.63),
	[10]    = vector3(242.1, 224.44, 106.29),
}

CreateThread(function()
	for Number,coord in pairs(Banks) do
		exports["ox_target"]:addBoxZone({
			name = "Bank:"..Number,
			coords = coord,
			size = vec3(3.0, 3.0, 3.0),
			options = {
				{
					event = "Bank",
					label = "Abrir Banco",
					icon = "fa-solid fa-building-columns",
					tunnel = "client"
				}
			}
		})
	end

	exports["ox_target"]:addModel({
		GetHashKey("prop_fleeca_atm"),
		GetHashKey("prop_atm_01"),
		GetHashKey("prop_atm_02"),
		GetHashKey("prop_atm_03"),
	},{
		{
			label = "Abrir ATM",
			icon = "fa-solid fa-money-bill-transfer",
			event = "Bank"
		}
	})

	while true do
		local timeDistance = 500
		local ped = PlayerPedId()
		for Number,coord in pairs(Banks) do
			local distance = #(GetEntityCoords(ped) - coord)
			if distance <= 5.0 then
				timeDistance = 1
				DrawBase3D(coord.x,coord.y,coord.z,"bank")
				if IsControlJustPressed(1,38) and distance <= 1.5 then
					SetNuiFocus(true,true)
					SendNUIMessage({ Action = "Open", name = LocalPlayer["state"]["Name"] })
					vRP.playAnim(false,{"amb@prop_human_atm@male@idle_a","idle_a"},false)
				end
			end
		end
		Wait(timeDistance)
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- BANK
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNetEvent("Bank")
AddEventHandler("Bank",function()
	SetNuiFocus(true,true)
	SendNUIMessage({ Action = "Open", name = LocalPlayer["state"]["Name"] })
	vRP.playAnim(false,{"amb@prop_human_atm@male@idle_a","idle_a"},false)
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CLOSE
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Close",function(Data,Callback)
	SetNuiFocus(false,false)
	SendNUIMessage({ Action = "Hide" })
	vRP.stopAnim()
	Callback(true)
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- HOME
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Home",function(Data,Callback)
	Callback(vSERVER.Home())
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- DEPOSIT
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Deposit",function(Data,Callback)
	Callback(vSERVER.Deposit(Data["value"]))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- WITHDRAW
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Withdraw",function(Data,Callback)
	Callback(vSERVER.Withdraw(Data["value"]))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- TRANSFER
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Transfer",function(Data,Callback)
	if Data["targetId"] and Data["value"] then
		Callback(vSERVER.Transfer(Data["targetId"],Data["value"]))
	else
		Callback(false)
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- ADDDEPENDENTS
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("AddDependents",function(Data,Callback)
	TriggerClientEvent("Notify",source,"amarelo","Sistema indisponível.",5000)
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- REMOVEDEPENDENTS
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("RemoveDependents",function(Data,Callback)
	TriggerClientEvent("Notify",source,"amarelo","Sistema indisponível.",5000)
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- INVESTMENTS
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Investments",function(Data,Callback)
	Callback(vSERVER.Investments())
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- INVEST
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Invest",function(Data,Callback)
	if Data["value"] then
		Callback(vSERVER.Invest(Data["value"]))
	else
		Callback(false)
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- INVESTRESCUE
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("InvestRescue",function(Data,Callback)
	vSERVER.InvestRescue()

	Callback(true)
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- TRANSACTIONHISTORY
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("TransactionHistory",function(Data,Callback)
	Callback(vSERVER.TransactionHistory())
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- MAKEINVOICE
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("MakeInvoice",function(Data,Callback)
	if Data["passport"] and Data["value"] and Data["reason"] then
		Callback(vSERVER.MakeInvoice(Data["passport"],Data["value"],Data["reason"]))
	else
		Callback(false)
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- INVOICEPAYMENT
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("InvoicePayment",function(Data,Callback)
	Callback(vSERVER.InvoicePayment(Data["id"]))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- INVOICELIST
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("InvoiceList",function(Data,Callback)
	Callback(vSERVER.InvoiceList())
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- FINELIST
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("FineList",function(Data,Callback)
	Callback(vSERVER.FineList())
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- FINEPAYMENT
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("FinePayment",function(Data,Callback)
	Callback(vSERVER.FinePayment(Data["id"]))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- FINEPAYMENTALL
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("FinePaymentAll",function(Data,Callback)
	Callback(vSERVER.FinePaymentAll())
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- TAXES
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Taxes",function(Data,Callback)
	Callback(vSERVER.TaxList())
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- TAXPAYMENT
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("TaxPayment",function(Data,Callback)
	Callback(vSERVER.TaxPayment(Data["id"]))
end)